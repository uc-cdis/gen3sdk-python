language: python
python:
- 3.6
before_install:
- 'curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py | python -'
- source $HOME/.poetry/env
- which poetry
- poetry --version
install:
- poetry install -vv
- poetry show
script:
- poetry run pytest -vv ./tests
before_deploy:
- poetry config repositories.testpypi https://test.pypi.org/legacy/ # remove
- poetry config pypi-token.testpypi $PYPI_API_TOKEN # poetry config pypi-token.pypi $PYPI_API_TOKEN
- poetry build -f sdist
deploy:
  skip_cleanup: true
  provider: script
  script: poetry publish -n -vv -r testpypi # poetry publish -n -vv
  on:
    python: 3.6
    repo: uc-cdis/gen3sdk-python
    # tags: true
env:
  global:
  - secure: jCslhsRF+cpozrC75nmYkBizmdBL/01StonnarwaWmCFBEzX22i6XklpUyROYRpvHTQ7SHJlFh+kmvptT4UmRxFCqKq/RNFq2We0rRhnfWNRsQOok5ENU5MDMgD0kl3RUeEElpVk36aQ8cUyybNyuel0ZFC1F+C5GOUKaCtiDrcX9RVu5jYbydi1W1RfsCNkmyJND8efdqBXD81BueXqP7xYxdyqz+f3du/1qIx5GR/X+jv6WE2Oum6EMq5tbiWf3qc6OnxNdNd0p/O7seBIZyvOZvFvX8Cx3PsCfSbWyeX0hcZCDIhnG5YTah944MplvVR70lOx0GvzmxHZCpxffUfliXLJCrBQy9RZbomXcXI6c1h88DMt6odYNDlZJpcV12sQypbWBr7FJb1En93FcSqpdoPKEU9eR+WzQ0/GNFL5KibZ95yQdwT31gnlnz7NLQz8ubdkrKMpZTbDM1HCAgLN326jMwYpn/RxRtXFcrxvA6sTxpsCQhWssIBRHv5sY0c5vlDkLADNAeA1s9+SOKWAKHJh5NzFby+vt59vi5QSkdWRsKwZsk01NNrBUFcJuDxsp9wTEO3NigzoYrnZXk2ews9+WRaiTmsEWa4/LSfY0afQA4ezbGVT4yY/tje2XFhsaYCT/JsJpHBgyNDadX6FaAraKw4oqsQDu76/KjU=
after_deploy:
- pip install gen3git
- gen3git release
